<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>AquaTech Pro - ุณุจุงูุฉ ุงุญุชุฑุงููุฉ ุนุจุฑ ุงููุงุชุณุงุจ | ูุชุฌุฑ ุฃุฏูุงุช ุงูุณุจุงูุฉ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="AquaTech Pro - ุฃูุถู ูุชุฌุฑ ูุฃุฏูุงุช ููุนุฏุงุช ุงูุณุจุงูุฉ ูู ูุตุฑ. ุฎุฏูุงุช ุณุจุงูุฉ ุงุญุชุฑุงููุฉุ ุชูุตูู ุณุฑูุนุ ุถูุงู ุดุงูู. ุงุทูุจ ุนุจุฑ ุงููุงุชุณุงุจ ุงูุขู!">
  <meta name="keywords" content="ุณุจุงูุฉ, ุฃุฏูุงุช ุณุจุงูุฉ, ููุงุณูุฑ, ุญูููุงุช, ูุถุฎุงุช ููุงู, ุณุจุงู, ุชุฑููุจุงุช ุณุจุงูุฉ, ูุตุฑ, ูุงุชุณุงุจ">
  <meta name="author" content="AquaTech Pro">
  <meta name="robots" content="index, follow">
  <meta name="language" content="Arabic">
  <meta name="geo.region" content="EG">
  <meta name="geo.country" content="Egypt">
  <link rel="icon" href="img/icon.png">
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="AquaTech Pro - ุณุจุงูุฉ ุงุญุชุฑุงููุฉ ุนุจุฑ ุงููุงุชุณุงุจ">
  <meta property="og:description" content="ุฃูุถู ูุชุฌุฑ ูุฃุฏูุงุช ููุนุฏุงุช ุงูุณุจุงูุฉ ูู ูุตุฑ. ุฎุฏูุงุช ุณุจุงูุฉ ุงุญุชุฑุงููุฉุ ุชูุตูู ุณุฑูุนุ ุถูุงู ุดุงูู">
  <meta property="og:image" content="https://mr-coder-2707.github.io/store1-test/img/icon.png">
  <meta property="og:url" content="https://mr-coder-2707.github.io/store1-test/">
  <meta property="og:type" content="website">
  <meta property="og:image:alt" content="ุดุนุงุฑ AquaTech Pro">
  <meta property="og:site_name" content="AquaTech Pro">
  <meta property="og:locale" content="ar_EG">
  <meta property="og:locale:alternate" content="en_US">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="AquaTech Pro - ุณุจุงูุฉ ุงุญุชุฑุงููุฉ ุนุจุฑ ุงููุงุชุณุงุจ">
  <meta name="twitter:description" content="ุฃูุถู ูุชุฌุฑ ูุฃุฏูุงุช ููุนุฏุงุช ุงูุณุจุงูุฉ ูู ูุตุฑ">
  <meta name="twitter:image" content="https://mr-coder-2707.github.io/store1-test/img/icon.png">
  <meta name="twitter:creator" content="@AquaTechPro">
  
  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "AquaTech Pro",
    "description": "ุฎุฏูุงุช ุณุจุงูุฉ ุงุญุชุฑุงููุฉ ููุชุฌุฑ ุฃุฏูุงุช ุงูุณุจุงูุฉ",
    "url": "https://mr-coder-2707.github.io/store1-test/",
    "telephone": "+201557609572",
    "priceRange": "$$",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "EG",
      "addressLocality": "Cairo"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": "30.0444",
      "longitude": "31.2357"
    },
    "openingHours": "Mo-Sa 09:00-18:00",
    "serviceArea": {
      "@type": "Country",
      "name": "Egypt"
    },
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "ููุชุฌุงุช ุงูุณุจุงูุฉ",
      "itemListElement": [
        {
          "@type": "OfferCatalog",
          "name": "ููุงุณูุฑ",
          "itemListElement": []
        },
        {
          "@type": "OfferCatalog", 
          "name": "ุญูููุงุช",
          "itemListElement": []
        },
        {
          "@type": "OfferCatalog",
          "name": "ุฃุฏูุงุช ุณุจุงูุฉ",
          "itemListElement": []
        }
      ]
    }
  }
  </script>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
  <link rel="manifest" href="manifest.json">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://mr-coder-2707.github.io/store1-test/">
  
  <!-- External CSS -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Google Fonts (if needed) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <style>
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title">AquaTech Pro โข ุณุจุงูุฉ ุงุญุชุฑุงููุฉ</div>
        <div class="subtitle">ุฎุฏูุงุช ุณุจุงูุฉ ูุชููุฒุฉ โ ุทูุจ ุงูููุชุฌุงุช โ ุชูุตูู ุณุฑูุน</div>
      </div>
    </div>
  </header>

  <nav>
    <div class="nav-container">
      <a href="index.html" class="nav-link active">๐ช ุงููุชุฌุฑ</a>
      <a href="about.html" class="nav-link">๐ฅ ูู ูุญู</a>
      <a href="terms.html" class="nav-link">๐ ุงูุดุฑูุท ูุงูุฃุญูุงู</a>
    </div>
  </nav>

  <section class="search-section">
    <div class="search-container">
      <div class="search-icon">๐</div>
      <input type="text" class="search-input" id="search-input" placeholder="ุงุจุญุซ ุนู ุงูููุชุฌุงุช...">
    </div>
    <div class="filter-tags" id="filter-tags">
      <div class="filter-tag active" data-category="all">ุฌููุน ุงูููุชุฌุงุช</div>
      <div class="filter-tag" data-category="ููุงุณูุฑ">ููุงุณูุฑ</div>
      <div class="filter-tag" data-category="ุญูููุงุช">ุญูููุงุช</div>
      <div class="filter-tag" data-category="ุฃุฏูุงุช">ุฃุฏูุงุช</div>
      <div class="filter-tag" data-category="ูุทุน ุบูุงุฑ">ูุทุน ุบูุงุฑ</div>
      <div class="filter-tag" data-category="ูุถุฎุงุช">ูุถุฎุงุช</div>
    </div>
  </section>

  <main>
    <section class="grid" id="products"></section>

    <section class="cart" aria-labelledby="cart-title">
      <div class="cart-header">
        <h2 id="cart-title">
          ุณูุฉ ุงูุชุณูู 
          <span class="cart-counter" id="cart-counter" style="display:none">0</span>
        </h2>
        <button class="btn secondary" id="clear-cart" style="display:none">ูุณุญ ุงูุณูุฉ</button>
      </div>
      
      <div class="cart-items" id="cart-items"></div>
      
      <div class="empty-cart" id="cart-empty">
        <div class="empty-cart-icon">๏ฟฝ๏ธ</div>
        <div>ุณูุฉ ุงูุชุณูู ูุงุฑุบุฉ</div>
        <div class="muted" style="font-size:14px; margin-top:4px">ุงุจุฏุฃ ุจุฅุถุงูุฉ ููุชุฌุงุช ุงูุณุจุงูุฉ ุงูุชู ุชุญุชุงุฌูุง!</div>
      </div>

      <div class="cart-summary" id="cart-summary" style="display:none">
        <div class="summary-row">
          <span class="summary-label">ุนุฏุฏ ุงูููุชุฌุงุช:</span>
          <span class="summary-value" id="items-count">0</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">ุงููุฌููุน ุงููุฑุนู:</span>
          <span class="summary-value" id="subtotal">0.00</span>
        </div>
        <div class="summary-row total">
          <span class="summary-label">ุงูุฅุฌูุงูู:</span>
          <span class="summary-value total" id="total-amount">0.00</span>
        </div>
        
        <div class="checkout-bar">
          <button class="btn" id="checkout">ุงูุฏูุน ุนุจุฑ ุงููุงุชุณุงุจ</button>
        </div>
      </div>

      <div class="form" id="checkout-form" style="display:none">
        <div class="field">
          <label for="cust-name">ุงูุงุณู ุงููุงูู</label>
          <input id="cust-name" placeholder="ูุซุงู: ุฃุญูุฏ ุนูู" />
        </div>
        <div class="field">
          <label for="cust-phone">ุฑูู ุงููุงุชู</label>
          <input id="cust-phone" placeholder="ูุซุงู: 201001234567" />
        </div>
        <div class="field">
          <label for="cust-email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <input id="cust-email" type="email" placeholder="ูุซุงู: name@example.com" />
        </div>
        <div class="field">
          <label for="cust-location">ุงููููุน/ุงูุนููุงู</label>
          <input id="cust-location" placeholder="ุงูููุฌ /ุงูุจูุฏ /ุงูุดุงุฑุน ุงููุจูุฑ" />
        </div>
        <div class="error" id="form-error"></div>
        <div class="ok" id="form-ok"></div>
        
        <!-- Warning message before checkout -->
        <div class="warning-box">
          <div class="warning-header">
            <span class="warning-icon">โ๏ธ</span>
            <strong>ุชูุจูู ููู ูุจู ุฅุชูุงู ุงูุทูุจ</strong>
          </div>
          <ul class="warning-list">
            <li><strong>๐๏ธ ูุนุงููุฉ ุงูููุชุฌุงุช:</strong> ูุฑุฌู ุงุณุชุฎุฏุงู ุฒุฑ "๐๏ธ" ููุนุงููุฉ ูู ููุชุฌ ุจุงูุชูุตูู ูุจู ุฅุถุงูุชู ููุณูุฉ</li>
            <li><strong>๐ ุณูุงุณุฉ ุงูุงุณุชุจุฏุงู:</strong> ูุญู ููุนููู ุงุณุชุจุฏุงู ุงูููุชุฌ ุฎูุงู 7 ุฃูุงู ูู ุชุงุฑูุฎ ุงูุงุณุชูุงู ุจุดุฑุท ุนุฏู ุงูุงุณุชุฎุฏุงู</li>
            <li><strong>๐ฆ ูุญุต ุงูููุชุฌ:</strong> ูุฌุจ ูุญุต ุงูููุชุฌ ุนูุฏ ุงูุงุณุชูุงู ูุงูุชุฃูุฏ ูู ุณูุงูุชู ูุจู ุงูุชูููุน</li>
            <li><strong>๐ ุฑุณูู ุงูุชูุตูู ูู 10ุฌ ุงูู 20ุฌ ูุงู ููุงู ุฏุงุฎู ุงูููุฌ ุฑุณูู ุงูุฅุฑุฌุงุน:</strong> ุงูุนููู ูุชุญูู ุฑุณูู ุงูุดุญู ูู ุญุงูุฉ ุงูุฅุฑุฌุงุน ุฅุฐุง ูู ููู ููุงู ุนูุจ ุจุงูููุชุฌ</li>

          </ul>
          <div class="warning-footer">
            ๐ก ููุงุณุชูุณุงุฑุงุช ุญูู ุณูุงุณุฉ ุงูุฅุฑุฌุงุน ูุงูุงุณุชุจุฏุงูุ ูุฑุฌู ุงูุชูุงุตู ูุนูุง ูุจู ุฅุชูุงู ุงูุทูุจ
          </div>
        </div>

        <!-- Terms and Conditions Agreement -->
        <div class="terms-agreement">
          <div class="terms-checkbox">
            <input type="checkbox" id="terms-agree" required>
            <label for="terms-agree" class="terms-text">
              <strong>โ ุฃูุงูู ุนูู ุฌููุน ุงูุณูุงุณุงุช ูุงูุดุฑูุท</strong><br>
              ูู ุญุงู ุฅุชูุงู ุนูููุฉ ุงูุดุฑุงุก ุฃูุช ูุฏู ููุงูู ุนูู ูู ุงูุณูุงุณุงุช ูุญููู ุงูุฅุฑุฌุงุน ูุงูุงุณุชุจุฏุงู ูุชุทุจู ุงูุดุฑูุท ูุงูุฃุญูุงู
            </label>
          </div>
          <div class="terms-notice">
            โ๏ธ ุจุงูุถุบุท ุนูู "ุฅุฑุณุงู ุงูุทูุจ" ุชุคูุฏ ููุงููุชู ุนูู ุฌููุน ูุง ูุฑุฏ ุฃุนูุงู ูุชุตุจุญ ููุฒูุงู ูุงููููุงู ุจูุฐู ุงูุดุฑูุท
          </div>
        </div>
        
        <div class="btn-actions">
          <button class="btn" id="send-whatsapp">ุฅุฑุณุงู ุงูุทูุจ ุนุจุฑ ุงููุงุชุณุงุจ</button>
          <button class="btn secondary" id="test-whatsapp">ุงุฎุชุจุงุฑ ุงููุงุชุณุงุจ</button>
          <button class="btn secondary" id="cancel-checkout" type="button">ุฅูุบุงุก</button>
        </div>
        <div class="form-small-text">
          ููุงุญุธุฉ: ุนูู ุงููุงุชู ุงููุญูููุ ุณูุชู ูุชุญ ุชุทุจูู ุงููุงุชุณุงุจ ูุจุงุดุฑุฉ. ุนูู ุณุทุญ ุงูููุชุจุ ุณูุชู ูุชุญ ูุงุชุณุงุจ ููุจ ูู ุชุจููุจ ุฌุฏูุฏ. ุงูุตูุฑ ูุง ูููู ุฅุฑูุงููุง ุชููุงุฆูุงูุ ุฑูุงุจุท ุงูุตูุฑ ูุถููุฉ ูู ุงูุฑุณุงูุฉ.
        </div>
      </div>
    </section>
  </main>

  <!-- Product Preview Modal -->
  <div class="modal-overlay" id="preview-modal">
    <div class="modal">
      <div class="modal-header">
        <h3>๐๏ธ ูุนุงููุฉ ุงูููุชุฌ</h3>
        <button class="modal-close" id="close-preview">&times;</button>
      </div>
      <div class="modal-body">
        <img class="preview-image" id="preview-img" src="" alt="">
        <div class="preview-category" id="preview-cat">ูุฆุฉ</div>
        <h2 class="preview-title" id="preview-name">ุงุณู ุงูููุชุฌ</h2>
        <div class="preview-price" id="preview-price">0.00 ุฌููู</div>
        <div class="preview-description" id="preview-desc">
          ูุฐุง ุงูููุชุฌ ุนุงูู ุงูุฌูุฏุฉ ููุตููุน ูู ููุงุฏ ุทุจูุนูุฉ 100%. ูุชููุฒ ุจูููุฉ ุฑุงุฆุนุฉ ูููุงุฆุฏ ุตุญูุฉ ูุชุนุฏุฏุฉ.
          ููุงุณุจ ููุงุณุชุฎุฏุงู ุงููููู ููุฃุชู ุจุชุบููู ูุญูู ููุญูุงุธ ุนูู ุงูุฌูุฏุฉ ูุงููุถุงุฑุฉ.
        </div>
        <div class="preview-controls">
          <div class="preview-qty">
            <button type="button" id="preview-minus">โ</button>
            <input type="number" id="preview-quantity" min="1" value="1" readonly>
            <button type="button" id="preview-plus">+</button>
          </div>
          <button class="btn" id="preview-add-to-cart">ุฃุถู ููุณูุฉ</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    ยฉ <span id="year"></span> AquaTech Pro - ุณุจุงูุฉ ุงุญุชุฑุงููุฉ. ุฎุฏูุงุช ุณุจุงูุฉ ูุชููุฒุฉ ูุชูุตูู ุณุฑูุน.
  </footer>

  <script>
    // ======= CONFIG =======
    const STORE_WHATSAPP_NUMBER = '201557609572'; // Egyptian number format
    const CURRENCY = 'EGP';

    // Debug info
    console.log('Store WhatsApp Number:', STORE_WHATSAPP_NUMBER);
    console.log('User Agent:', navigator.userAgent);

    // Sample product catalog (edit as needed)
    const PRODUCTS = [
            { 
        id: 'p1', 
        name: 'ุจูุฑุฉ ุชูููู 50 ูุชุฑ ุญุฌู ูุจูุฑ ', 
        price:20, 
        category: 'ุฃุฏูุงุช', 
        img:'./img/20250909_125009.jpg',
        description: 'ุจูุฑุฉ ุชูููู ุนุงููุฉ ุงูุฌูุฏุฉ 50 ูุชุฑ ุญุฌู ูุจูุฑุ ููุงุณุจุฉ ูุฌููุน ุฃุนูุงู ุงูุณุจุงูุฉ ูุงูุชุฑููุจุงุช'
            },
              { 
        id: 'p2', 
        name: 'ููุจ ุญูููุฉ /ูุฎูุงุท 3.5 ูููู ุงูุทุงูู ', 
        price: 25, 
        category: 'ูุทุน ุบูุงุฑ', 
        img: './img/20250909_124903.jpg',
        description: 'ููุจ ุญูููุฉ ุฅูุทุงูู ุนุงูู ุงูุฌูุฏุฉ 3.5 ููููุ ููุงูู ููุชุขูู ููุฏูู ููุชุฑุฉ ุทูููุฉ'
            },
      { 
        id: 'p3', 
        name: 'ุญูููุฉ ูุทุจุฎ ุณุชุงููุณ ุณุชูู ูุน ุฑุดุงุด', 
        price: 35, 
        category: 'ุญูููุงุช', 
        img: './img/2.png',
        description: 'ุญูููุฉ ูุทุจุฎ ูุงุฎุฑุฉ ูู ุงูุณุชุงููุณ ุณุชูู ุงูููุงูู ููุตุฏุฃ. ูุฒูุฏุฉ ุจุฑุดุงุด ูุงุจู ููุณุญุจ. ุชุตููู ุนุตุฑู ุฃููู. ุณููุฉ ุงูุชูุธูู ูุงูุตูุงูุฉ. ุถูุงู 5 ุณููุงุช ูู ุงูุดุฑูุฉ ุงููุตูุนุฉ.'
            },
            { 
        id: 'p4', 
        name: 'ุณูููู ุญูุงู ูุฑูู ูุงูุน', 
        price: 50, 
        category: 'ูุทุน ุบูุงุฑ', 
        img: './img/6.png',
        description: 'ุณูููู ุญูุงู ูู ุงููุฑูู ุงููุงูุน ุงูููุงูู ููุชุขูู. ุชุตููู ุฃููู ููุงุณุจ ุงูุญูุงูุงุช ุงูุนุตุฑูุฉ. ุณูู ุงูุชูุธูู ูุงูุตูุงูุฉ. ูุฒูุฏ ุจุตูุงู ููุน ุงูุฑูุงุฆุญ. ุชุฑููุจ ุณูู ุจุฏูู ุฃุฏูุงุช ุฎุงุตุฉ.'
            },
            { 
        id: 'p5', 
        name: 'ุญูููุฉ pg  smart copper ูุญุงุณ ุจูุฏู', 
        price: 135, 
        category: 'ุญูููุงุช', 
        img:'./img/PG-CU.jpg',
        description: 'ุญูููุฉ ูุญุงุณ ุจูุงูู ูุง ุชุตุฏุฃ ุงูููุจ ูุง ูุชูู ุจูุชุบูุฑ ูู ุฌูุงู "ุฌูุฏ ุญูููุฉ ุจูุฏู"ุจุถูุงู ุงุณูุฑุช ููุจูุฑ '
            },
              { 
        id: 'p6', 
        name: 'ุญูููุฉ pg  smart copper ูุญุงุณ ุณูููุฉ', 
        price: 110, 
        category: 'ุญูููุงุช', 
        img:'./img/PG-OR.jpg',
        description: 'ุญูููุฉ ูุญุงุณ ุจูุงูู ูุง ุชุตุฏุฃ "ุณูููุฉ ูุงููุฑ ูุญุงุณ " ุจุถูุงู ุงุณูุฑุช ููุจูุฑ '
            },
                    { 
        id: 'p7', 
        name: 'ุญูููุฉ pg  smart copper ูุญุงุณ ุณูููุฉ', 
        price: 125, 
        category: 'ุญูููุงุช', 
        img:'./img/PG-RED.jpg',
        description: 'ุญูููุฉ ูุญุงุณ ุจูุงูู ูุง ุชุตุฏุฃ "ุณูููุฉ ูุงููุฑ ูุญุงุณ  ููุงููุฑ ุจูุงุณุชู ุงุญูุฑ " ุจุถูุงู ุงุณูุฑุช ููุจูุฑ '
            },
        { 
        id: 'p8', 
        name: 'ุญูููุฉ LAVOR  smart copper ูุญุงุณ ุณูููุฉ', 
        price: 70, 
        category: 'ุญูููุงุช', 
        img:'./img/LAVOR-B.jpg',
        description: 'ุญูููุฉ ูุญุงุณ ุจูุงูู ูุง ุชุตุฏุฃ "ุณูููุฉ ูุงููุฑ  ุจูุงุณุชู ูุฒู ุฎููู " ุจุถูุงู ุงุณูุฑุช ููุจูุฑ '
            },
                    { 
        id: 'p9', 
        name: 'ุญูููุฉุณูููุฉ PVC ุจูุงุณุชู ุงุจูุถ', 
        price: 45, 
        category: 'ุญูููุงุช', 
        img:'./img/PVC-W.jpg',
        description:' ูุน ุงูุนูู ุงู ุงูุญูููุงุช ุงูุจูุงุณุชู ูุงุชุฑุฏ ู ูุง ุชุณุชุจุฏู ุงููุฏ ุจูุงุณุชู ูุฏุนููุฉ ุจูุทุนุฉ ุญุฏูุฏ ุญูููุฉุณูููุฉ PVC ุจูุงุณุชู ุงุจูุถ "ุจุณู ูุญุงุณ ู ุงูุฌุณู PVC"' 
            },
                    { 
        id: 'p10', 
        name: 'ุญูููุฉุณูููุฉ PVC ุจูุงุณุชู ุงุณูุฏ', 
        price: 35, 
        category: 'ุญูููุงุช', 
        img:'./img/PVC-B.jpg',
        description:'ูุน ุงูุนูู ุงู ุงูุญูููุงุช ุงูุจูุงุณุชู ูุงุชุฑุฏ ู ูุง ุชุณุชุจุฏู  ุญูููุฉุณูููุฉ PVC  ุงููุฏ ุจูุงุณุชู ุจูุงูู  ุจูุงุณุชู ุงุณูุฏ "ุจุณู ูุญุงุณ ู ุงูุฌุณู PVC"' 
            },
                                { 
        id: 'p11', 
        name: 'ุญูููุฉ ูุงูููุฉ ุถุบุท ููุจููุดู FIRST ', 
        price: 35, 
        category: 'ุญูููุงุช', 
        img:'./img/FIRST.jpg',
        description:'ุญูููุฉ ูุงูููุฉ ููุจููุดู FIRST ูุน ุงูุนูู ุงู ุงูุญูููุงุช ุงูุจูุงุณุชู ูุงุชุฑุฏ ู ูุง ุชุณุชุจุฏู'
                },


        ];
    // ======= STATE =======
    const cart = new Map(); // id -> { product, qty }
    let currentFilter = 'all';
    let searchTerm = '';
    let currentPreviewProduct = null;

    // ======= HELPERS =======
    const fmt = (n) => new Intl.NumberFormat(undefined, { style: 'currency', currency: CURRENCY, maximumFractionDigits: 2 }).format(n);

    function getFilteredProducts() {
      return PRODUCTS.filter(product => {
        const matchesSearch = searchTerm === '' || product.name.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesFilter = currentFilter === 'all' || product.category === currentFilter;
        return matchesSearch && matchesFilter;
      });
    }

    function renderProducts() {
      const list = document.getElementById('products');
      list.innerHTML = '';
      const filteredProducts = getFilteredProducts();
      
      if (filteredProducts.length === 0) {
        list.innerHTML = `
          <div style="grid-column: span 12; text-align: center; padding: 40px; color: var(--muted);">
            <div style="font-size: 48px; margin-bottom: 16px;">๐</div>
            <div>ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุฌุงุช</div>
            <div style="font-size: 14px; margin-top: 8px;">ุฌุฑุจ ูููุงุช ุจุญุซ ุฃุฎุฑู ุฃู ุบูุฑ ุงูููุชุฑ</div>
          </div>
        `;
        return;
      }

      filteredProducts.forEach(p => {
        const el = document.createElement('article');
        el.className = 'product';
        el.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="body">
            <h3>${p.name}</h3>
            <div class="price">${fmt(p.price)}</div>
            <div class="controls">
              <div class="qty" data-id="${p.id}">
                <button type="button" aria-label="ุชูููู">โ</button>
                <input type="number" min="1" value="1" inputmode="numeric" />
                <button type="button" aria-label="ุฒูุงุฏุฉ">+</button>
              </div>
              <button class="btn preview" data-id="${p.id}">๐๏ธ</button>
              <button class="btn add" data-id="${p.id}">ุฃุถู ููุณูุฉ</button>
            </div>
          </div>
        `;
        list.appendChild(el);
      });

      // attach qty controls
      list.querySelectorAll('.qty').forEach(q => {
        const input = q.querySelector('input');
        q.children[0].addEventListener('click', () => { input.value = Math.max(1, (parseInt(input.value||'1',10)-1)); });
        q.children[2].addEventListener('click', () => { input.value = Math.max(1, (parseInt(input.value||'1',10)+1)); });
      });

      // add-to-cart handlers
      list.querySelectorAll('.btn.add').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const p = PRODUCTS.find(x => x.id === id);
          const qtyInput = btn.parentElement.querySelector('input');
          const qty = Math.max(1, parseInt(qtyInput.value || '1', 10));
          const existing = cart.get(id);
          cart.set(id, { product: p, qty: (existing?.qty || 0) + qty });
          renderCart();
          
          // Add animation effect
          btn.classList.add('animate-add');
          btn.textContent = 'ุชู ุงูุฅุถุงูุฉ โ';
          setTimeout(() => {
            btn.textContent = 'ุฃุถู ููุณูุฉ';
            btn.classList.remove('animate-add');
          }, 1000);
        });
      });

      // preview handlers
      list.querySelectorAll('.btn.preview').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const product = PRODUCTS.find(x => x.id === id);
          if (product) {
            showProductPreview(product);
          }
        });
      });
    }

    function renderCart() {
      const container = document.getElementById('cart-items');
      const empty = document.getElementById('cart-empty');
      const summary = document.getElementById('cart-summary');
      const counter = document.getElementById('cart-counter');
      const clearBtn = document.getElementById('clear-cart');
      
      container.innerHTML = '';
      let subtotal = 0;
      let itemsCount = 0;

      if (cart.size === 0) {
        empty.style.display = 'block';
        summary.style.display = 'none';
        counter.style.display = 'none';
        clearBtn.style.display = 'none';
        document.getElementById('checkout-form').style.display = 'none';
        return;
      }
      
      empty.style.display = 'none';
      summary.style.display = 'block';
      counter.style.display = 'inline-block';
      clearBtn.style.display = 'inline-block';

      cart.forEach(({product, qty}) => {
        const line = product.price * qty;
        subtotal += line;
        itemsCount += qty;
        
        const item = document.createElement('div');
        item.className = 'cart-item';
        item.innerHTML = `
          <img src="${product.img}" alt="${product.name}">
          <div class="cart-item-info">
            <div class="cart-item-name">${product.name}</div>
            <div class="cart-item-price">${fmt(product.price)} ร ${qty} = ${fmt(line)}</div>
          </div>
          <div class="cart-qty-controls">
            <button class="minus" data-id="${product.id}">โ</button>
            <div class="cart-qty-display">${qty}</div>
            <button class="plus" data-id="${product.id}">+</button>
          </div>
          <button class="btn danger remove" data-id="${product.id}">ุญุฐู</button>
        `;
        container.appendChild(item);
      });

      // Update summary
      counter.textContent = itemsCount;
      document.getElementById('items-count').textContent = itemsCount;
      document.getElementById('subtotal').textContent = fmt(subtotal);
      document.getElementById('total-amount').textContent = fmt(subtotal);

      container.querySelectorAll('.minus').forEach(b=>{
        b.addEventListener('click', ()=>{
          const id = b.getAttribute('data-id');
          const entry = cart.get(id);
          if (!entry) return;
          entry.qty = Math.max(1, entry.qty - 1);
          cart.set(id, entry);
          renderCart();
        });
      });
      container.querySelectorAll('.plus').forEach(b=>{
        b.addEventListener('click', ()=>{
          const id = b.getAttribute('data-id');
          const entry = cart.get(id);
          if (!entry) return;
          entry.qty += 1;
          cart.set(id, entry);
          renderCart();
        });
      });
      container.querySelectorAll('.remove').forEach(b=>{
        b.addEventListener('click', ()=>{
          cart.delete(b.getAttribute('data-id'));
          renderCart();
        });
      });
    }

    function showCheckoutForm(show=true){
      document.getElementById('checkout-form').style.display = show ? '' : 'none';
      document.getElementById('form-error').style.display = 'none';
      document.getElementById('form-ok').style.display = 'none';
    }

    function showProductPreview(product) {
      currentPreviewProduct = product;
      
      // Update modal content
      document.getElementById('preview-img').src = product.img;
      document.getElementById('preview-img').alt = product.name;
      document.getElementById('preview-cat').textContent = product.category;
      document.getElementById('preview-name').textContent = product.name;
      document.getElementById('preview-price').textContent = fmt(product.price);
      document.getElementById('preview-desc').textContent = product.description;
      document.getElementById('preview-quantity').value = 1;
      
      // Show modal
      document.getElementById('preview-modal').style.display = 'flex';
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }

    function hideProductPreview() {
      document.getElementById('preview-modal').style.display = 'none';
      document.body.style.overflow = 'auto'; // Restore scrolling
      currentPreviewProduct = null;
    }

    function validateForm() {
      const name = document.getElementById('cust-name').value.trim();
      const phone = document.getElementById('cust-phone').value.trim();
      const email = document.getElementById('cust-email').value.trim();
      const location = document.getElementById('cust-location').value.trim();
      const termsAgreed = document.getElementById('terms-agree').checked;
      const errors = [];

      if (name.length < 2) errors.push('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณูู ุงููุงูู.');
      
      // More flexible phone validation
      const cleanPhone = phone.replace(/\D/g, '');
      if (cleanPhone.length < 8 || cleanPhone.length > 15) {
        errors.push('ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู 8-15 ุฑูู ุจุงูุตูุบุฉ ุงูุฏูููุฉ (ูุซุงู: 201001234567).');
      }
      
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        errors.push('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุจุฑูุฏ ุฅููุชุฑููู ุตุญูุญ ุฃู ุงุชุฑูู ูุงุฑุบุงู.');
      }

      if (location.length < 5) {
        errors.push('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงููููุน ุจุงูุชูุตูู (ุงููุฏููุฉุ ุงูุญูุ ุงูุดุงุฑุน).');
      }

      if (!termsAgreed) {
        errors.push('ูุฌุจ ุงูููุงููุฉ ุนูู ุงูุดุฑูุท ูุงูุฃุญูุงู ูุจู ุฅุชูุงู ุงูุทูุจ.');
      }

      return { valid: errors.length === 0, errors, name, phone: cleanPhone, email, location, termsAgreed };
    }

    function buildWhatsappMessage(customer, items) {
      const lines = [];
      lines.push(`๏ฟฝ *ุทูุจ ุฌุฏูุฏ ูู AquaTech Pro*`);
      lines.push('');
      lines.push(`๐ค *ุงูุนููู*: ${customer.name}`);
      lines.push(`๐ *ุงููุงุชู*: ${customer.phone}`);
      if (customer.email) lines.push(`โ๏ธ *ุงูุจุฑูุฏ ุงูุฅููุชุฑููู*: ${customer.email}`);
      lines.push(`๐ *ุงููููุน*: ${customer.location}`);
      lines.push('');
      lines.push(`๐๏ธ *ุงูููุชุฌุงุช ุงููุทููุจุฉ:*`);
      let total = 0;
      items.forEach(({product, qty})=>{
        const line = product.price * qty;
        total += line;
        lines.push(`โข ${product.name} โ ${qty} ร ${product.price} ${CURRENCY} = ${line} ${CURRENCY}`);
        lines.push(`   ุงูุตูุฑุฉ: ${product.img}`);
      });
      lines.push('');
      lines.push(`๐ฐ *ุฅุฌูุงูู ุงูุทูุจ*: ${total} ${CURRENCY}`);
      lines.push('');
      lines.push(`๐ *ูุฑุฌู ุชุฃููุฏ ุงูุชููุฑ ูููุงุนูุฏ ุงูุชูุตูู*`);
      lines.push(`๐ *ุฎุฏูุฉ ุงูุชุฑููุจ ูุชููุฑุฉ ุนูุฏ ุงูุทูุจ*`);
      return lines.join('\n');
    }

    function openWhatsapp(message, toNumber) {
      // Clean and format the phone number
      const cleanNumber = toNumber.replace(/\D/g, ''); // Remove non-digits
      
      // Create WhatsApp URL
      const url = `https://wa.me/${cleanNumber}?text=${encodeURIComponent(message)}`;
      
      console.log('Opening WhatsApp with URL:', url); // Debug log
      
      // Check if it's a mobile device
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      if (isMobile) {
        // On mobile, open WhatsApp app directly
        window.location.href = url;
      } else {
        // On desktop, try to open in new window
        try {
          const newWindow = window.open(url, '_blank', 'noopener,noreferrer');
          // Check if popup was blocked
          if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
            // Fallback: use location.href
            window.location.href = url;
          }
        } catch (error) {
          console.error('Error opening WhatsApp:', error);
          // Final fallback
          window.location.href = url;
        }
      }
    }

    // ======= EVENTS =======
    // Search functionality
    document.getElementById('search-input').addEventListener('input', (e) => {
      searchTerm = e.target.value.trim();
      renderProducts();
    });

    // Filter functionality
    document.querySelectorAll('.filter-tag').forEach(tag => {
      tag.addEventListener('click', () => {
        document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
        tag.classList.add('active');
        currentFilter = tag.getAttribute('data-category');
        renderProducts();
      });
    });

    document.getElementById('clear-cart').addEventListener('click', ()=>{
      cart.clear(); renderCart();
    });

    document.getElementById('checkout').addEventListener('click', ()=>{
      if (cart.size === 0) return;
      showCheckoutForm(true);
      document.getElementById('cust-name').focus();
    });

    document.getElementById('cancel-checkout').addEventListener('click', ()=>{
      showCheckoutForm(false);
    });

    // Preview modal events
    document.getElementById('close-preview').addEventListener('click', hideProductPreview);
    
    // Close modal when clicking overlay
    document.getElementById('preview-modal').addEventListener('click', (e) => {
      if (e.target.id === 'preview-modal') {
        hideProductPreview();
      }
    });

    // Preview quantity controls
    document.getElementById('preview-minus').addEventListener('click', () => {
      const input = document.getElementById('preview-quantity');
      input.value = Math.max(1, parseInt(input.value) - 1);
    });

    document.getElementById('preview-plus').addEventListener('click', () => {
      const input = document.getElementById('preview-quantity');
      input.value = parseInt(input.value) + 1;
    });

    // Add to cart from preview
    document.getElementById('preview-add-to-cart').addEventListener('click', () => {
      if (!currentPreviewProduct) return;
      
      const qty = parseInt(document.getElementById('preview-quantity').value);
      const existing = cart.get(currentPreviewProduct.id);
      cart.set(currentPreviewProduct.id, { 
        product: currentPreviewProduct, 
        qty: (existing?.qty || 0) + qty 
      });
      
      renderCart();
      hideProductPreview();
      
      // Show success message
      const btn = document.getElementById('preview-add-to-cart');
      const originalText = btn.textContent;
      btn.textContent = 'ุชูุช ุงูุฅุถุงูุฉ โ';
      btn.style.background = '#16a34a';
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
      }, 1000);
    });

    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        hideProductPreview();
      }
    });

    // Test WhatsApp button
    document.getElementById('test-whatsapp').addEventListener('click', ()=>{
      const testMessage = '๐ง ูุฑุญุจุง! ูุฐู ุฑุณุงูุฉ ุงุฎุชุจุงุฑ ูู AquaTech Pro - ุณุจุงูุฉ ุงุญุชุฑุงููุฉ. โ\n\nูุญู ุฌุงูุฒูู ูุฎุฏูุชูู!';
      console.log('=== WHATSAPP TEST ===');
      console.log('Testing WhatsApp with number:', STORE_WHATSAPP_NUMBER);
      console.log('Test message:', testMessage);
      console.log('User agent:', navigator.userAgent);
      
      try {
        openWhatsapp(testMessage, STORE_WHATSAPP_NUMBER);
        console.log('openWhatsapp function called successfully');
      } catch (error) {
        console.error('Error in test:', error);
        alert('ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุงููุงุชุณุงุจ: ' + error.message);
      }
    });

    document.getElementById('send-whatsapp').addEventListener('click', ()=>{
      const { valid, errors, name, phone, email } = validateForm();
      const errBox = document.getElementById('form-error');
      const okBox  = document.getElementById('form-ok');

      if (!valid) {
        errBox.textContent = errors.join(' ');
        errBox.style.display = '';
        okBox.style.display = 'none';
        return;
      }

      const items = Array.from(cart.values());
      const msg = buildWhatsappMessage({name, phone, email}, items);
      
      console.log('Sending WhatsApp message:', msg);
      console.log('Phone number used:', phone);
      
      // Show different message based on device type
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      console.log('Is mobile device:', isMobile);
      
      okBox.textContent = isMobile ? 'ูุชุญ ุชุทุจูู ุงููุงุชุณุงุจ...' : 'ูุชุญ ูุงุชุณุงุจ ููุจ...';
      okBox.style.display = '';
      errBox.style.display = 'none';

      // Add small delay to show the message
      setTimeout(() => {
        try {
          openWhatsapp(msg, STORE_WHATSAPP_NUMBER);
        } catch (error) {
          console.error('Error in openWhatsapp:', error);
          errBox.textContent = 'ุญุฏุซ ุฎุทุฃ ูู ูุชุญ ุงููุงุชุณุงุจ: ' + error.message;
          errBox.style.display = '';
          okBox.style.display = 'none';
        }
      }, 500);
    });

    // ======= INIT =======
    document.getElementById('year').textContent = new Date().getFullYear();
    renderProducts();
    renderCart();
  </script>
</body>
</html>
